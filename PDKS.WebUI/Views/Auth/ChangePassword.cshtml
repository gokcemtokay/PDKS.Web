@* ============================================ *@
@* Auth/ChangePassword.cshtml *@

@{
    ViewData["Title"] = "Şifre Değiştir";
}

<div class="row">
    <div class="col-md-6 mx-auto">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-key me-2"></i> Şifre Değiştir
            </div>
            <div class="card-body">
                @if (TempData["Error"] != null)
                {
                    <div class="alert alert-danger alert-dismissible fade show">
                        <i class="fas fa-exclamation-circle me-2"></i> @TempData["Error"]
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                }

                <form method="post" asp-controller="Auth" asp-action="ChangePassword" id="changePasswordForm">
                    <div class="mb-3">
                        <label for="oldPassword" class="form-label">Mevcut Şifre <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="oldPassword" name="oldPassword" required>
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('oldPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="newPassword" class="form-label">Yeni Şifre <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="newPassword" name="newPassword" 
                                   minlength="6" required>
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                        <small class="form-text text-muted">En az 6 karakter olmalıdır</small>
                    </div>

                    <div class="mb-3">
                        <label for="confirmPassword" class="form-label">Yeni Şifre (Tekrar) <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" 
                                   minlength="6" required>
                            <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmPassword')">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </div>

                    <div class="mb-3" id="passwordStrength" style="display:none;">
                        <small class="text-muted">Şifre Gücü:</small>
                        <div class="progress">
                            <div class="progress-bar" id="strengthBar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <small id="strengthText" class="text-muted"></small>
                    </div>

                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Güvenli şifre için:</strong>
                        <ul class="mb-0 mt-2">
                            <li>En az 6 karakter kullanın</li>
                            <li>Büyük ve küçük harf karışımı kullanın</li>
                            <li>Rakam ve özel karakter ekleyin</li>
                        </ul>
                    </div>

                    <hr>

                    <div class="d-flex justify-content-between">
                        <a href="/" class="btn btn-secondary">
                            <i class="fas fa-arrow-left"></i> İptal
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Şifreyi Değiştir
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

@section Scripts {

    <script>
        function togglePassword(fieldId) {
            var field = document.getElementById(fieldId);
            if (field.type === "password") {
                field.type = "text";
            } else {
                field.type = "password";
            }
        }

        // Password strength checker
        $('#newPassword').on('input', function() {
            var password = $(this).val();
            var strength = 0;
            
            if (password.length >= 6) strength += 20;
            if (password.length >= 8) strength += 20;
            if (password.match(/[a-z]+/)) strength += 20;
            if (password.match(/[A-Z]+/)) strength += 20;
            if (password.match(/[0-9]+/)) strength += 10;
            if (password.match(/[$@@#&!]+/)) strength += 10;
            
            var bar = $('#strengthBar');
            var text = $('#strengthText');
            
            bar.css('width', strength + '%');
            
            if (strength < 40) {
                bar.removeClass().addClass('progress-bar bg-danger');
                text.text('Zayıf').css('color', '#dc3545');
            } else if (strength < 70) {
                bar.removeClass().addClass('progress-bar bg-warning');
                text.text('Orta').css('color', '#ffc107');
            } else {
                bar.removeClass().addClass('progress-bar bg-success');
                text.text('Güçlü').css('color', '#28a745');
            }
            
            $('#passwordStrength').show();
        });

        // Form validation
        $('#changePasswordForm').submit(function(e) {
            var newPassword = $('#newPassword').val();
            var confirmPassword = $('#confirmPassword').val();
            
            if (newPassword !== confirmPassword) {
                e.preventDefault();
                Swal.fire({
                    icon: 'error',
                    title: 'Hata',
                    text: 'Yeni şifreler eşleşmiyor!'
                });
                return false;
            }
            
            if (newPassword.length < 6) {
                e.preventDefault();
                Swal.fire({
                    icon: 'error',
                    title: 'Hata',
                    text: 'Şifre en az 6 karakter olmalıdır!'
                });
                return false;
            }
        });

    </script>

}