@* ============================================ *@
@* Rapor/AylikDevamCizelgesi.cshtml *@

@model PDKS.Business.DTOs.AylikDevamCizelgesiDTO
@{
    ViewData["Title"] = "Aylık Devam Çizelgesi";
    var filtre = ViewBag.Filtre as PDKS.Business.DTOs.RaporFiltreDTO;
}

<div class="row mb-3">
    <div class="col-md-8">
        <form method="post" asp-action="AylikDevamCizelgesi" class="row g-3">
            <div class="col-md-4">
                <label class="form-label">Personel <span class="text-danger">*</span></label>
                <select name="PersonelId" class="form-select" asp-items="ViewBag.Personeller" required>
                    <option value="">Personel Seçiniz</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Yıl</label>
                <select name="Yil" class="form-select" asp-items="ViewBag.Yillar" required>
                    <option value="">Yıl</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Ay</label>
                <select name="Ay" class="form-select" asp-items="ViewBag.Aylar" required>
                    <option value="">Ay</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">&nbsp;</label>
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-calendar"></i> Görüntüle
                </button>
            </div>
        </form>
    </div>
    <div class="col-md-4 text-end">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Raporlar
        </a>
    </div>
</div>

@if (Model != null)
{
    <div class="card">
        <div class="card-header bg-info text-white">
            <i class="fas fa-calendar-alt me-2"></i> Aylık Devam Çizelgesi
            <span class="badge bg-light text-dark ms-2">@Model.Donem</span>
        </div>
        <div class="card-body">
            <!-- Personel Bilgisi -->
            <div class="mb-4">
                <h5>@Model.PersonelAdi</h5>
                <p class="text-muted mb-0">
                    Sicil: <strong>@Model.SicilNo</strong> |
                    Departman: <strong>@Model.Departman</strong>
                </p>
            </div>

            <!-- İstatistikler -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body text-center">
                            <h3>@Model.ToplamCalismaGunu</h3>
                            <small>Çalışma Günü</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-danger text-white">
                        <div class="card-body text-center">
                            <h3>@Model.ToplamDevamsizGun</h3>
                            <small>Devamsız Gün</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning">
                        <div class="card-body text-center">
                            <h3>@Model.ToplamIzinGun</h3>
                            <small>İzinli Gün</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                            <h3>@Model.ToplamCalismaSaati</h3>
                            <small>Toplam Saat</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Çizelge -->
            <div class="table-responsive">
                <table class="table table-bordered table-sm">
                    <thead class="table-secondary">
                        <tr>
                            <th>Tarih</th>
                            <th>Gün</th>
                            <th>Giriş</th>
                            <th>Çıkış</th>
                            <th>Çalışma Süresi</th>
                            <th>Durum</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var gun in Model.Gunler)
                        {
                            <tr class="@(gun.Durum == "Devamsız" ? "table-danger" : "")
                                       @(gun.Durum.Contains("İzinli") ? "table-warning" : "")
                                       @(gun.Durum == "Tatil" || gun.Durum == "Hafta Sonu" ? "table-secondary" : "")">
                                <td>@gun.Tarih.ToString("dd.MM")</td>
                                <td>@gun.Tarih.ToString("ddd")</td>
                                <td>
                                    @if (gun.GirisZamani.HasValue)
                                    {
                                        @gun.GirisZamani.Value.ToString("HH:mm")
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                                <td>
                                    @if (gun.CikisZamani.HasValue)
                                    {
                                        @gun.CikisZamani.Value.ToString("HH:mm")
                                    }
                                    else
                                    {
                                        <span class="text-muted">-</span>
                                    }
                                </td>
                                <td>@gun.CalismaSuresiText</td>
                                <td>
                                    @if (gun.Durum == "Normal")
                                    {
                                        <span class="badge bg-success">@gun.Durum</span>
                                    }
                                    else if (gun.Durum == "Geç Kalmış")
                                    {
                                        <span class="badge bg-warning">@gun.Durum</span>
                                    }
                                    else if (gun.Durum == "Devamsız")
                                    {
                                        <span class="badge bg-danger">@gun.Durum</span>
                                    }
                                    else if (gun.Durum.Contains("İzinli"))
                                    {
                                        <span class="badge bg-warning">@gun.Durum</span>
                                    }
                                    else if (gun.Durum == "Tatil" || gun.Durum == "Hafta Sonu")
                                    {
                                        <span class="badge bg-secondary">@gun.Durum</span>
                                    }
                                    else if (gun.Durum == "Fazla Mesai")
                                    {
                                        <span class="badge bg-primary">@gun.Durum</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-info">@gun.Durum</span>
                                    }
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
}
else
{
    <div class="card">
        <div class="card-body text-center py-5">
            <i class="fas fa-calendar-alt fa-4x text-muted mb-3"></i>
            <h5>Devam Çizelgesini Görüntüle</h5>
            <p class="text-muted">Personel, yıl ve ay seçerek aylık devam çizelgesini görüntüleyin.</p>
        </div>
    </div>
}